@echo off

@REM Record the procmon.exe path
set PM=C:\Users\WDAGUtilityAccount\Desktop\Procmon\Procmon.exe

@REM Automatically accepts the license and load new filter to only get info about .exe files
start %PM% /AcceptEula /Backingfile C:\Users\WDAGUtilityAccount\Desktop\Result.pml /LoadConfig C:\Users\WDAGUtilityAccount\Desktop\NewConfiguration\NewConfiguration.pmc

@REM .exe file would run in 3 seconds
timeout /t 3

@REM Read all the name of submitted files
findstr /v "^$" C:\Users\WDAGUtilityAccount\Desktop\UncheckedFileName\File_Name.txt | find /c /v "" > temp.txt

@REM Count how many files are submitted
set /P OEM=<temp.txt

@REM Del temporary file
del temp.txt

@REM Verify the amount of submitted files
if %OEM% == 1 (

	@REM Get the unchecked file name
	set /P Fname=<C:\Users\WDAGUtilityAccount\Desktop\UncheckedFileName\File_Name.txt

	@REM Run the .exe file
	start /Wait C:\Users\WDAGUtilityAccount\Desktop\BehaviourTestSamples\%Fname%

) else (
	
	@REM Aotumatically run every file with specified name in File_Name.txt
	for /F "tokens=*" %%i in (C:\Users\WDAGUtilityAccount\Desktop\UncheckedFileName\File_Name.txt) do (

		start C:\Users\WDAGUtilityAccount\Desktop\BehaviourTestSamples\%%i

	) 
)
