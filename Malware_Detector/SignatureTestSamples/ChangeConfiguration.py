from procmon_parser import load_configuration, dump_configuration, Rule
import os

# Open the initial configuration file of procmon filter
with open("C:\\Users\\12051\\Desktop\\ProcmonConfiguration.pmc", "rb") as f:
	config = load_configuration(f)

# For only one .exe file to be detedcted(remember to change the name)
# new_rules = [Rule('Process_Name', 'contains', 'python')]
# config["FilterRules"] = new_rules + config["FilterRules"]

# For a directory contains .exe files
file_name = ""
with open("C:\\Users\\12051\\Desktop\\UncheckedFileName\\File_Name.txt", "r") as f:
	file_name_list = f.readlines()

	for file in file_name_list:

		name = file.strip()
		print(name)
		new_rules = [Rule('Process_Name', 'contains', name)]
		config["FilterRules"] = new_rules + config["FilterRules"]


config["DestructiveFilter"] = 1

# Change the configuration file
with open("C:\\Users\\12051\\Desktop\\NewConfiguration\\NewConfiguration.pmc", "wb") as f:
	dump_configuration(config, f)

