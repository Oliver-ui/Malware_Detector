@echo off


rem This piece of code can save data automatically when exe is closed in local system but always no responding in sandbox.

rem Record the procmon.exe path
set PM=C:\Users\WDAGUtilityAccount\Desktop\Procmon\Procmon.exe

rem Automatically accepts the license and load new filter to only get info about .exe files
start %PM% /AcceptEula /Backingfile C:\Users\WDAGUtilityAccount\Desktop\Result.pml /LoadConfig C:\Users\WDAGUtilityAccount\Desktop\NewConfiguration\NewConfiguration.pmc

timeout /t 3

findstr /v "^$" C:\Users\WDAGUtilityAccount\Desktop\UncheckedFileName\File_Name.txt | find /c /v "" > temp.txt

set /P OEM=<temp.txt

del temp.txt

if %OEM% == 1 (

    rem Record path of unchecked file
	cd C:\Users\WDAGUtilityAccount\Desktop\UncheckedFileName

	rem rem Get the unchecked file name
	set /P Fname=<File_Name.txt

	rem Run the .exe file
	start /Wait C:\Users\WDAGUtilityAccount\Desktop\UncheckedWare\%Fname%

) else (

	cd C:\Users\WDAGUtilityAccount\Desktop\UncheckedFileName

	set targe=''
	setlocal enabledelayedexpansion

	set /a count = 0


	for /f %%i in (File_Name.txt) do (
	
		set /a count += 1

		set target=%%i

		start C:\Users\WDAGUtilityAccount\Desktop\BehaviourTestSample\!target!

	) 
)
